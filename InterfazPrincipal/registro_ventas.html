<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Ventas - LicoresTorres</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom right, #f8fafc, #e2e8f0);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(to right, #d97706, #b45309);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1rem 1.5rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-box {
            background: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo-box i {
            font-size: 32px;
            color: #d97706;
        }

        .logo-text h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo-text p {
            color: #fde68a;
            font-size: 0.875rem;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .page-title {
            color: #1f2937;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title i {
            color: #10b981;
            font-size: 2.5rem;
        }

        .page-subtitle {
            color: #6b7280;
            margin-bottom: 2rem;
        }

        /* Two Column Layout */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 1.5rem;
        }

        /* Form Section */
        .form-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .section-title {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: #10b981;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            color: #374151;
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-group label .required {
            color: #ef4444;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
        }

        .form-row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #10b981;
            color: white;
            width: 100%;
            font-size: 1rem;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .client-info {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .client-info h4 {
            color: #065f46;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .client-info p {
            color: #047857;
            font-size: 0.875rem;
            margin: 0.25rem 0;
        }

        /* Cart Section */
        .cart-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 1.5rem;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
        }

        .cart-item-details {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .cart-item-price {
            font-weight: bold;
            color: #10b981;
            margin-left: 1rem;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            margin-left: 0.5rem;
        }

        .cart-empty {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }

        .cart-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .cart-summary {
            border-top: 2px solid #e5e7eb;
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: #6b7280;
        }

        .summary-row.total {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .summary-row.total span:last-child {
            color: #10b981;
        }

        /* Search Section */
        .search-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }



        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Sales Table */
        .sales-table-section {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .results-count {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f9fafb;
        }

        th {
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.875rem;
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 0.875rem;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .cart-section {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .form-row, .form-row-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-box">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="logo-text">
                    <h1>LicoresTorres</h1>
                    <p>Registro de Ventas</p>
                </div>
            </div>
            <button class="back-btn" onclick="window.location.href='Principal.html'">
                <i class="fas fa-arrow-left"></i>
                Volver al Inicio
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <div class="page-title">
            <i class="fas fa-cash-register"></i>
            Registro de Ventas
        </div>
        <p class="page-subtitle">Registra las ventas de productos y genera comprobantes</p>

        <div class="content-grid">
            <!-- Form Section -->
            <div class="form-section">
                <h2 class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    Nueva Venta
                </h2>

                <!-- Client Info Form -->
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Nombre del Cliente <span class="required">*</span></label>
                        <input type="text" id="clientName" placeholder="Ej: Juan" required>
                    </div>
                    <div class="form-group">
                        <label>Apellido del Cliente <span class="required">*</span></label>
                        <input type="text" id="clientLastName" placeholder="Ej: Pérez" required>
                    </div>
                </div>

                <div id="clientInfoDisplay" class="client-info" style="display: none;">
                    <h4><i class="fas fa-user"></i> Cliente Registrado</h4>
                    <p><strong>Nombre:</strong> <span id="displayClientName"></span></p>
                </div>

                <!-- Product Form -->
                <form id="saleForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Producto <span class="required">*</span></label>
                            <select id="productSelect" required>
                                <option value="">Seleccionar producto...</option>
                                <option value="1" data-price="5.50">Cerveza Pilsen 620ml</option>
                                <option value="2" data-price="45.00">Vino Tacama Tinto</option>
                                <option value="3" data-price="35.00">Ron Cartavio XO</option>
                                <option value="4" data-price="120.00">Whisky Johnny Walker Red</option>
                                <option value="5" data-price="6.00">Cerveza Cusqueña 650ml</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad <span class="required">*</span></label>
                            <input type="number" id="quantity" min="1" max="99" value="1" required>
                        </div>
                        <div class="form-group">
                            <label>Precio Unit.</label>
                            <input type="number" id="price" step="0.01" readonly>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-cart-plus"></i>
                        Agregar al Carrito
                    </button>
                </form>
            </div>

            <!-- Cart Section -->
            <div class="cart-section">
                <h2 class="section-title">
                    <i class="fas fa-shopping-cart"></i>
                    Carrito de Venta
                </h2>

                <div class="cart-items" id="cartItems">
                    <div class="cart-empty">
                        <i class="fas fa-shopping-basket"></i>
                        <p>No hay productos en el carrito</p>
                    </div>
                </div>

                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">S/ 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>IGV (18%):</span>
                        <span id="igv">S/ 0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">S/ 0.00</span>
                    </div>

                    <button class="btn btn-primary" id="finalizeSale" style="margin-top: 1rem;" disabled>
                        <i class="fas fa-check-circle"></i>
                        Finalizar Venta
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h2 class="section-title">
                <i class="fas fa-search"></i>
                Buscar Ventas por Cliente
            </h2>

            <div style="display: flex; gap: 1rem; align-items: end;">
                <div class="form-group" style="flex: 1;">
                    <label>Nombre o Apellido del Cliente</label>
                    <input type="text" id="searchClient" placeholder="Buscar por nombre o apellido..." onkeyup="searchSales()">
                </div>
                <button class="btn btn-secondary" onclick="clearSearch()" style="width: auto;">
                    <i class="fas fa-times"></i>
                    Limpiar
                </button>
            </div>
        </div>

        <!-- Sales History Table -->
        <div class="sales-table-section">
            <div class="table-header">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    Historial de Ventas
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span class="results-count" id="resultsCount">Mostrando 0 ventas</span>
                    <button class="btn btn-secondary" onclick="clearAllSales()" style="width: auto; padding: 0.5rem 1rem;">
                        <i class="fas fa-trash"></i>
                        Limpiar Historial
                    </button>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Nº Venta</th>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Productos</th>
                            <th>Cantidad</th>
                            <th>Total</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="salesHistory">
                        <tr>
                            <td colspan="7" class="no-results">
                                <i class="fas fa-inbox"></i>
                                <p>No hay ventas registradas</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let cart = [];
        let allSales = [];
        let currentClient = null;

        // Load sales from localStorage on page load
        window.addEventListener('load', function() {
            loadSales();
            loadInventory(); // Cargar inventario para sincronizar
            displaySales(allSales);
        });

        // Cargar inventario desde localStorage
        function loadInventory() {
            const data = localStorage.getItem("inventario_productos");
            if (data) {
                return JSON.parse(data);
            }
            return [];
        }

        // Guardar inventario en localStorage
        function saveInventory(productos) {
            localStorage.setItem("inventario_productos", JSON.stringify(productos));
        }

        // Actualizar stock en inventario
        function updateInventoryStock(productId, quantitySold) {
            let productos = loadInventory();
            
            console.log('=== ACTUALIZANDO INVENTARIO ===');
            console.log('Producto ID a buscar:', productId, 'Tipo:', typeof productId);
            console.log('Cantidad vendida:', quantitySold);
            console.log('Inventario completo:', productos);
            
            // Buscar el producto por ID y reducir su stock
            const productIndex = productos.findIndex(p => {
                console.log('Comparando:', p.id, 'con', parseInt(productId), '- Match:', p.id === parseInt(productId));
                return p.id === parseInt(productId);
            });
            
            console.log('Índice encontrado:', productIndex);
            
            if (productIndex !== -1) {
                const oldStock = productos[productIndex].stockActual;
                productos[productIndex].stockActual -= quantitySold;
                
                // Asegurarse de que el stock no sea negativo
                if (productos[productIndex].stockActual < 0) {
                    productos[productIndex].stockActual = 0;
                }
                
                console.log(`Stock actualizado: ${productos[productIndex].nombre}`);
                console.log(`Stock anterior: ${oldStock} -> Nuevo stock: ${productos[productIndex].stockActual}`);
                
                saveInventory(productos);
                console.log('Inventario guardado en localStorage');
            } else {
                console.error('¡PRODUCTO NO ENCONTRADO EN INVENTARIO!');
                console.log('IDs disponibles:', productos.map(p => p.id));
            }
            console.log('=== FIN ACTUALIZACIÓN ===');
        }

        // Update client info display
        document.getElementById('clientName').addEventListener('input', updateClientDisplay);
        document.getElementById('clientLastName').addEventListener('input', updateClientDisplay);

        function updateClientDisplay() {
            const name = document.getElementById('clientName').value.trim();
            const lastName = document.getElementById('clientLastName').value.trim();
            
            if (name && lastName) {
                currentClient = { name, lastName };
                document.getElementById('displayClientName').textContent = `${name} ${lastName}`;
                document.getElementById('clientInfoDisplay').style.display = 'block';
            } else {
                currentClient = null;
                document.getElementById('clientInfoDisplay').style.display = 'none';
            }
        }

        // Update price when product is selected
        document.getElementById('productSelect').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const price = selectedOption.dataset.price;
            document.getElementById('price').value = price || '';
        });

        // Add to cart
        document.getElementById('saleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentClient) {
                alert('Por favor ingrese el nombre y apellido del cliente');
                return;
            }
            
            const select = document.getElementById('productSelect');
            const selectedOption = select.options[select.selectedIndex];
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = parseFloat(selectedOption.dataset.price);
            
            if (!selectedOption.value) return;
            
            // Verificar stock disponible antes de agregar
            const productos = loadInventory();
            const producto = productos.find(p => p.id === parseInt(selectedOption.value));
            
            if (producto && producto.stockActual < quantity) {
                alert(`Stock insuficiente. Solo hay ${producto.stockActual} unidades disponibles de ${producto.nombre}`);
                return;
            }
            
            const item = {
                id: selectedOption.value,
                name: selectedOption.text,
                quantity: quantity,
                price: price,
                total: quantity * price
            };
            
            cart.push(item);
            updateCart();
            
            // Reset product fields only
            document.getElementById('productSelect').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('price').value = '';
        });

        // Update cart display
        function updateCart() {
            const cartItemsDiv = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="cart-empty">
                        <i class="fas fa-shopping-basket"></i>
                        <p>No hay productos en el carrito</p>
                    </div>
                `;
                document.getElementById('finalizeSale').disabled = true;
            } else {
                cartItemsDiv.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-details">${item.quantity} x S/ ${item.price.toFixed(2)}</div>
                        </div>
                        <div class="cart-item-price">S/ ${item.total.toFixed(2)}</div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
                document.getElementById('finalizeSale').disabled = false;
            }
            
            updateSummary();
        }

        // Remove from cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
        }

        // Update summary
        function updateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
            const igv = subtotal * 0.18;
            const total = subtotal + igv;
            
            document.getElementById('subtotal').textContent = `S/ ${subtotal.toFixed(2)}`;
            document.getElementById('igv').textContent = `S/ ${igv.toFixed(2)}`;
            document.getElementById('total').textContent = `S/ ${total.toFixed(2)}`;
        }

        // Finalize sale
        document.getElementById('finalizeSale').addEventListener('click', function() {
            if (cart.length === 0 || !currentClient) return;
            
            const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
            const igv = subtotal * 0.18;
            const total = subtotal + igv;
            const now = new Date();
            
            const sale = {
                id: Date.now(),
                saleNumber: allSales.length + 1,
                date: now,
                clientName: currentClient.name,
                clientLastName: currentClient.lastName,
                products: [...cart],
                subtotal: subtotal,
                igv: igv,
                total: total,
                status: 'Completada'
            };
            
            allSales.unshift(sale);
            saveSales();
            
            // ACTUALIZAR INVENTARIO: Reducir stock de cada producto vendido
            cart.forEach(item => {
                updateInventoryStock(item.id, item.quantity);
            });
            
            // ACTUALIZAR DASHBOARD: Actualizar estadísticas en el dashboard principal
            updateDashboardStats();
            
            displaySales(allSales);
            
            // Clear cart and client
            cart = [];
            currentClient = null;
            updateCart();
            document.getElementById('clientName').value = '';
            document.getElementById('clientLastName').value = '';
            document.getElementById('clientInfoDisplay').style.display = 'none';
            
            alert('¡Venta registrada exitosamente!\nEl inventario ha sido actualizado.');
        });

        // Save sales to localStorage
        function saveSales() {
            localStorage.setItem('licoresTorres_sales', JSON.stringify(allSales));
        }

        // Load sales from localStorage
        function loadSales() {
            const saved = localStorage.getItem('licoresTorres_sales');
            if (saved) {
                allSales = JSON.parse(saved);
                // Convert date strings back to Date objects
                allSales.forEach(sale => {
                    sale.date = new Date(sale.date);
                });
            }
        }

        // Display sales in table
        function displaySales(sales) {
            const tbody = document.getElementById('salesHistory');
            const resultsCount = document.getElementById('resultsCount');
            
            if (sales.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-results">
                            <i class="fas fa-inbox"></i>
                            <p>No se encontraron ventas</p>
                        </td>
                    </tr>
                `;
                resultsCount.textContent = 'Mostrando 0 ventas';
                return;
            }
            
            tbody.innerHTML = sales.map(sale => {
                const dateStr = formatDate(sale.date);
                const productNames = sale.products.map(p => p.name).join(', ');
                const totalQuantity = sale.products.reduce((sum, p) => sum + p.quantity, 0);
                
                return `
                    <tr>
                        <td><strong>#${sale.saleNumber.toString().padStart(4, '0')}</strong></td>
                        <td>${dateStr}</td>
                        <td><strong>${sale.clientName} ${sale.clientLastName}</strong></td>
                        <td>${productNames}</td>
                        <td>${totalQuantity}</td>
                        <td><strong>S/ ${sale.total.toFixed(2)}</strong></td>
                        <td><span class="badge badge-success">${sale.status}</span></td>
                    </tr>
                `;
            }).join('');
            
            resultsCount.textContent = `Mostrando ${sales.length} venta${sales.length !== 1 ? 's' : ''}`;
        }

        // Format date
        function formatDate(date) {
            const d = new Date(date);
            const day = d.getDate().toString().padStart(2, '0');
            const month = (d.getMonth() + 1).toString().padStart(2, '0');
            const year = d.getFullYear();
            const hours = d.getHours().toString().padStart(2, '0');
            const minutes = d.getMinutes().toString().padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Search sales (only by client name)
        function searchSales() {
            const clientSearch = document.getElementById('searchClient').value.toLowerCase().trim();
            
            if (!clientSearch) {
                displaySales(allSales);
                return;
            }
            
            const filtered = allSales.filter(sale => {
                const fullName = `${sale.clientName} ${sale.clientLastName}`.toLowerCase();
                return fullName.includes(clientSearch);
            });
            
            displaySales(filtered);
        }

        // Clear search
        function clearSearch() {
            document.getElementById('searchClient').value = '';
            displaySales(allSales);
        }

        // Clear all sales history
        function clearAllSales() {
            if (confirm('¿Estás seguro de que deseas eliminar TODO el historial de ventas?\n\nEsta acción no se puede deshacer.')) {
                localStorage.removeItem('licoresTorres_sales');
                allSales = [];
                displaySales(allSales);
                updateDashboardStats();
                alert('Historial de ventas eliminado correctamente');
            }
        }

        // Actualizar estadísticas del dashboard principal
        function updateDashboardStats() {
            // Calcular ventas del día actual
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const todaySales = allSales.filter(sale => {
                const saleDate = new Date(sale.date);
                saleDate.setHours(0, 0, 0, 0);
                return saleDate.getTime() === today.getTime();
            });
            
            const totalToday = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const transactionsToday = todaySales.length;
            
            // Guardar en localStorage para que el dashboard lo lea
            localStorage.setItem('dashboard_stats', JSON.stringify({
                ventasHoy: totalToday,
                transaccionesHoy: transactionsToday,
                lastUpdate: new Date().toISOString()
            }));
        }
    </script>
</body>
</html>
