<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LICORERIA TORRES</title>
    <link rel="stylesheet" href="estilos.css" />
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img class="logo" src="Imagenes/logo.png" alt="Logo Licores Torres">
        </div>

        <!-- FORMULARIO LOGIN -->
        <div class="form-container" id="loginForm">
            <h2>Iniciar Sesión</h2>
            <form onsubmit="return validarLogin()">
                <input id="correoLogin" type="email" placeholder="Correo electrónico" />
                <input id="claveLogin" type="password" placeholder="Contraseña" />
                <button type="submit" class="btn">Ingresar</button>
            </form>

            <!-- Texto eliminado: ya NO hay registro -->
            <p style="color:gray;font-size:14px;">Acceso exclusivo para personal autorizado.</p>

            <p id="contadorBloqueo" style="color:red;font-weight:bold;"></p>
        </div>

        <!-- FORMULARIO REGISTRO (AHORA SE OCULTA Y NO FUNCIONA) -->
        <div class="form-container oculto" id="registerForm" style="display:none;"></div>
    </div>

    <script>

        // --------------------------
        //   VARIABLES DE BLOQUEO
        // --------------------------
        let intentos = parseInt(localStorage.getItem("intentosFallidos")) || 0;
        let bloqueoHasta = parseInt(localStorage.getItem("bloqueoHasta")) || 0;
        let duracionBloqueo = parseInt(localStorage.getItem("duracionBloqueo")) || 60000; // 1 minuto

        //  USUARIOS PREDEFINIDOS
        const usuarios = [
            { correo: "torres@gmail.com", clave: "torres123" },
            { correo: "admin@gmail.com", clave: "admin123" }
        ];

        function actualizarContador() {
            const ahora = Date.now();
            if (bloqueoHasta > ahora) {
                let restante = Math.ceil((bloqueoHasta - ahora) / 1000);
                document.getElementById("contadorBloqueo").textContent =
                    "Acceso bloqueado. Espera " + restante + " segundos...";
                setTimeout(actualizarContador, 1000);
            } else {
                document.getElementById("contadorBloqueo").textContent = "";
            }
        }
        actualizarContador();

        // ---------------------------------------------------------------------
        // VALIDAR LOGIN
        // ---------------------------------------------------------------------
        function validarLogin() {

            const ahora = Date.now();

            //  SI ESTÁ BLOQUEADO
            if (ahora < bloqueoHasta) {
                alert("Cuenta bloqueada. Espera un momento.");
                actualizarContador();
                return false;
            }

            const email = document.getElementById("correoLogin").value;
            const pass = document.getElementById("claveLogin").value;

            if (email.trim() === '' || pass.trim() === '') {
                alert('Complete todos los campos.');
                return false;
            }

            // Buscar si coincide con los usuarios predefinidos
            const usuarioValido = usuarios.find(u => u.correo === email && u.clave === pass);

            //  DATOS INCORRECTOS
            if (!usuarioValido) {
                intentos++;
                localStorage.setItem("intentosFallidos", intentos);

                alert('Correo o contraseña incorrectos. Intento ' + intentos + ' de 5.');

                //  BLOQUEO ACTIVADO
                if (intentos >= 5) {
                    bloqueoHasta = ahora + duracionBloqueo;
                    localStorage.setItem("bloqueoHasta", bloqueoHasta);

                    alert("Has sido bloqueado por " + duracionBloqueo / 1000 + " segundos.");

                    //  DUPLICAR TIEMPO DE BLOQUEO (1 → 2 → 4 → 8 min)
                    duracionBloqueo *= 2;
                    localStorage.setItem("duracionBloqueo", duracionBloqueo);

                    intentos = 0;
                    localStorage.setItem("intentosFallidos", intentos);

                    actualizarContador();
                }

                return false;
            }

            //  LOGIN CORRECTO → REINICIAR TODO
            localStorage.setItem("duracionBloqueo", 60000);
            localStorage.removeItem("intentosFallidos");
            localStorage.removeItem("bloqueoHasta");

            window.location.href = "../InterfazPrincipal/Principal.html";
            return false;
        }
    </script>

</body>
</html>
