<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LICORERIA TORRES</title>
    <link rel="stylesheet" href="estilos.css" />
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img class="logo" src="Imagenes/logo.png" alt="Logo Licores Torres">
        </div>

        <!-- FORMULARIO LOGIN -->
        <div class="form-container" id="loginForm">
            <h2>Iniciar Sesión</h2>
            <form onsubmit="return validarLogin()">
                <input id="correoLogin" type="email" placeholder="Correo electrónico" />
                <input id="claveLogin" type="password" placeholder="Contraseña" />
                <button type="submit" class="btn">Ingresar</button>
            </form>
            <p>¿No tienes cuenta? <a href="#" onclick="mostrarRegistro()">Regístrate</a></p>

            <!-- Mostrar contador -->
            <p id="contadorBloqueo" style="color:red;font-weight:bold;"></p>
        </div>

        <!-- FORMULARIO REGISTRO -->
        <div class="form-container oculto" id="registerForm">
            <h2>Crear Cuenta</h2>
            <form onsubmit="return registrarUsuario()">
                <label>Nombres:</label>
                <input id="nombre" type="text" placeholder="Nombres" required />
                <label>Apellido Paterno:</label>
                <input id="apellidoP" type="text" placeholder="Apellido Paterno" required>
                <label>Apellido Materno:</label>
                <input id="apellidoM" type="text" placeholder="Apellido Materno" required>
                <label>Gmail:</label>
                <input id="correo" type="email" placeholder="Correo electrónico" required />
                <label>Contraseña:</label>
                <input id="clave" type="password" placeholder="Contraseña" required />
                <label>Edad:</label>
                <input id="edad" type="number" min="18" max="100" placeholder="Edad" required />
                <button type="submit" class="btn">Crear cuenta</button>
            </form>
            <p>¿Ya tienes cuenta? <a href="#" onclick="mostrarLogin()">Inicia sesión</a></p>
        </div>
    </div>

    <script>

        // --------------------------
        //   VARIABLES DE BLOQUEO
        // --------------------------
        let intentos = parseInt(localStorage.getItem("intentosFallidos")) || 0;
        let bloqueoHasta = parseInt(localStorage.getItem("bloqueoHasta")) || 0;
        let duracionBloqueo = parseInt(localStorage.getItem("duracionBloqueo")) || 60000; // 1 min = 60000 ms

        function actualizarContador() {
            const ahora = Date.now();
            if (bloqueoHasta > ahora) {
                let restante = Math.ceil((bloqueoHasta - ahora) / 1000);
                document.getElementById("contadorBloqueo").textContent =
                    "Acceso bloqueado. Espera " + restante + " segundos...";
                setTimeout(actualizarContador, 1000);
            } else {
                document.getElementById("contadorBloqueo").textContent = "";
            }
        }
        actualizarContador();

        // MOSTRAR REGISTRO
        function mostrarRegistro() {
            document.getElementById("loginForm").classList.add("oculto");
            document.getElementById("registerForm").classList.remove("oculto");
        }

        // MOSTRAR LOGIN
        function mostrarLogin() {
            document.getElementById("registerForm").classList.add("oculto");
            document.getElementById("loginForm").classList.remove("oculto");
        }

        function registrarUsuario() {
            const correo = document.getElementById("correo").value;
            const clave = document.getElementById("clave").value;
            const edad = document.getElementById("edad").value;

            if (clave.length < 8) {
                alert("La contraseña debe tener mínimo 8 caracteres.");
                return false;
            }

            if (edad < 18) {
                alert("Debes tener 18 años o más para registrarte a esta pagina.");
                return false;
            }

            localStorage.setItem("correoUsuario", correo);
            localStorage.setItem("claveUsuario", clave);

            alert("Usuario registrado correctamente.");
            mostrarLogin();
            return false;
        }

        // VALIDAR LOGIN
        function validarLogin() {
            const ahora = Date.now();

            //  SI ESTÁ BLOQUEADO
            if (ahora < bloqueoHasta) {
                alert("Cuenta bloqueada. Espera un momento.");
                actualizarContador();
                return false;
            }

            const email = document.getElementById("correoLogin").value;
            const pass = document.getElementById("claveLogin").value;

            const correoReg = localStorage.getItem("correoUsuario");
            const claveReg = localStorage.getItem("claveUsuario");

            if (email.trim() === '' || pass.trim() === '') {
                alert('Complete todos los campos.');
                return false;
            }

            //  DATOS INCORRECTOS
            if (email !== correoReg || pass !== claveReg) {
                intentos++;
                localStorage.setItem("intentosFallidos", intentos);

                alert('Correo o contraseña incorrectos. Intento ' + intentos + ' de 5.');

                //  BLOQUEO ACTIVADO
                if (intentos >= 5) {
                    bloqueoHasta = ahora + duracionBloqueo;
                    localStorage.setItem("bloqueoHasta", bloqueoHasta);

                    alert("Has sido bloqueado por " + duracionBloqueo / 1000 + " segundos.");

                    //  DUPLICAR TIEMPO DE BLOQUEO (1 → 2 → 4 → 8 min)
                    duracionBloqueo *= 2;
                    localStorage.setItem("duracionBloqueo", duracionBloqueo);

                    intentos = 0;
                    localStorage.setItem("intentosFallidos", intentos);

                    actualizarContador();
                }

                return false;
            }

            // ✔️ LOGIN CORRECTO → REINICIAR TODO
            localStorage.setItem("duracionBloqueo", 60000);
            localStorage.removeItem("intentosFallidos");
            localStorage.removeItem("bloqueoHasta");

            window.location.href = "../InterfazPrincipal/Principal.html";
            return false;
        }
    </script>

</body>
</html>
